<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Item - BUBT Lost and Found System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/create-item-styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="nav-brand">
                <i class="fas fa-search-location"></i>
                <h1>BUBT Lost & Found</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="{{ url_for('dashboard') }}" class="nav-link">Dashboard</a></li>
                <li><a href="{{ url_for('create_item') }}" class="nav-link active">Create Item</a></li>
                <li><a href="{{ url_for('report') }}" class="nav-link">Report Items</a></li>
                <li><a href="{{ url_for('search') }}" class="nav-link">Search Items</a></li>
                <li><a href="{{ url_for('invoice') }}" class="nav-link">Generate Invoice</a></li>
                <li><a href="{{ url_for('about') }}" class="nav-link">About</a></li>
            </ul>
            <div class="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>

    <main class="main">
        <!-- Hero Section -->
        <section class="create-item-hero">
            <div class="hero-content">
                <h1 class="hero-title">
                    <i class="fas fa-plus-circle"></i>
                    Create New Item
                </h1>
                <p class="hero-description">
                    Add a new lost or found item to the system database with our intuitive form
                </p>
            </div>
        </section>

        <!-- Create Item Section -->
        <section id="create-item" class="create-item-section">
            <div class="container">
                <h2 class="section-title">Item Details</h2>
                <p class="section-description">Fill out the form below to create your item entry</p>
                
                <!-- Create Item Form -->
                <div class="create-item-container">
                    <form id="create-item-form" class="create-item-form">
                        <!-- Basic Information -->
                        <div class="form-section" data-section="basic">
                            <h3><i class="fas fa-info-circle"></i> Basic Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="item-name">Item Name *</label>
                                    <input type="text" id="item-name" name="item-name" placeholder="e.g., iPhone 13 Pro, Gold Necklace" required>
                                </div>
                                <div class="form-group">
                                    <label for="item-category">Category *</label>
                                    <select id="item-category" name="item-category" required>
                                        <option value="">Select Category</option>
                                        <option value="electronics">Electronics</option>
                                        <option value="jewelry">Jewelry</option>
                                        <option value="clothing">Clothing</option>
                                        <option value="documents">Documents</option>
                                        <option value="keys">Keys</option>
                                        <option value="books">Books</option>
                                        <option value="bags">Bags & Backpacks</option>
                                        <option value="watches">Watches</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="item-status">Status *</label>
                                    <select id="item-status" name="item-status" required>
                                        <option value="">Select Status</option>
                                        <option value="lost">Lost</option>
                                        <option value="found">Found</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="item-date">Date *</label>
                                    <input type="date" id="item-date" name="item-date" required>
                                </div>
                            </div>
                        </div>

                        <!-- Location Information -->
                        <div class="form-section" data-section="location">
                            <h3><i class="fas fa-map-marker-alt"></i> Location Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="item-location">Location *</label>
                                    <input type="text" id="item-location" name="item-location" placeholder="e.g., Main Library, 2nd Floor, Room 205" required>
                                </div>
                                <div class="form-group">
                                    <label for="item-building">Building</label>
                                    <select id="item-building" name="item-building">
                                        <option value="">Select Building</option>
                                        <option value="main-building">Main Building</option>
                                        <option value="library">Library</option>
                                        <option value="student-center">Student Center</option>
                                        <option value="cafeteria">Cafeteria</option>
                                        <option value="parking">Parking Area</option>
                                        <option value="gymnasium">Gymnasium</option>
                                        <option value="computer-lab">Computer Lab</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="item-floor">Floor/Room</label>
                                <input type="text" id="item-floor" name="item-floor" placeholder="e.g., 2nd Floor, Room 205">
                            </div>
                        </div>

                        <!-- Item Details -->
                        <div class="form-section" data-section="details">
                            <h3><i class="fas fa-tags"></i> Item Details</h3>
                            <div class="form-group">
                                <label for="item-description">Description *</label>
                                <textarea id="item-description" name="item-description" rows="4" placeholder="Provide detailed description of the item, including any identifying marks, colors, brand, model, or special features" required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="item-color">Color</label>
                                    <input type="text" id="item-color" name="item-color" placeholder="e.g., Black, Blue, Red">
                                </div>
                                <div class="form-group">
                                    <label for="item-brand">Brand/Model</label>
                                    <input type="text" id="item-brand" name="item-brand" placeholder="e.g., Apple iPhone 13 Pro, Samsung Galaxy">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="item-value">Estimated Value (BDT)</label>
                                <input type="number" id="item-value" name="item-value" placeholder="e.g., 50000" min="0">
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="form-section">
                            <h3><i class="fas fa-user"></i> Contact Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="item-contact">Contact Email *</label>
                                    <input type="email" id="item-contact" name="item-contact" placeholder="your.email@bubt.edu.bd" required>
                                </div>
                                <div class="form-group">
                                    <label for="item-phone">Phone Number</label>
                                    <input type="tel" id="item-phone" name="item-phone" placeholder="e.g., +880 17XX XXX XXX">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="item-student-id">Student ID (if applicable)</label>
                                <input type="text" id="item-student-id" name="item-student-id" placeholder="e.g., 2024001">
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <div class="form-section">
                            <h3><i class="fas fa-plus-circle"></i> Additional Information</h3>
                            <div class="form-group">
                                <label for="item-notes">Additional Notes</label>
                                <textarea id="item-notes" name="item-notes" rows="3" placeholder="Any additional information, special instructions, or context about the item"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="item-priority">Priority Level</label>
                                <select id="item-priority" name="item-priority">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="resetForm()">
                                <i class="fas fa-undo"></i> Reset Form
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Create Item
                            </button>
                        </div>
                    </form>

                    <!-- Form Preview -->
                    <div class="form-preview">
                        <h3><i class="fas fa-eye"></i> Item Preview</h3>
                        <div id="item-preview" class="preview-content">
                            <p class="preview-placeholder">Fill out the form to see a preview of your item</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // Initialize create item page
        document.addEventListener('DOMContentLoaded', function() {
            // Check login status first
            checkLoginStatus();
            
            // Set current date
            document.getElementById('item-date').value = new Date().toISOString().split('T')[0];
            
            // Initialize form preview
            initializeFormPreview();
            
            // Initialize form submission
            initializeCreateItemForm();
            
            // Initialize dynamic form features
            initializeDynamicFeatures();
            
            // Add form section animations
            addFormSectionAnimations();
        });

        // Check if user is logged in
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn !== 'true') {
                // User is not logged in, redirect to login page
                window.location.href = 'index.html';
            }
        }

        // Initialize form preview
        function initializeFormPreview() {
            const form = document.getElementById('create-item-form');
            const inputs = form.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                input.addEventListener('input', updatePreview);
                input.addEventListener('change', updatePreview);
            });
        }

        // Update preview
        function updatePreview() {
            const preview = document.getElementById('item-preview');
            const formData = new FormData(document.getElementById('create-item-form'));
            
            let previewHTML = '';
            
            if (formData.get('item-name')) {
                previewHTML = `
                    <div class="preview-item">
                        <h4>${formData.get('item-name')}</h4>
                        <p><strong>Category:</strong> ${formData.get('item-category') || 'Not specified'}</p>
                        <p><strong>Status:</strong> <span class="status-${formData.get('item-status')}">${formData.get('item-status')?.toUpperCase() || 'Not specified'}</span></p>
                        <p><strong>Date:</strong> ${formData.get('item-date') || 'Not specified'}</p>
                        <p><strong>Location:</strong> ${formData.get('item-location') || 'Not specified'}</p>
                        <p><strong>Description:</strong> ${formData.get('item-description') || 'Not specified'}</p>
                        <p><strong>Contact:</strong> ${formData.get('item-contact') || 'Not specified'}</p>
                    </div>
                `;
            } else {
                previewHTML = '<p class="preview-placeholder">Fill out the form to see a preview of your item</p>';
            }
            
            preview.innerHTML = previewHTML;
        }

        // Initialize create item form
        function initializeCreateItemForm() {
            const form = document.getElementById('create-item-form');
            form.addEventListener('submit', handleCreateItem);
        }

        // Handle create item form submission
        function handleCreateItem(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const newItem = {
                id: Date.now(), // Generate unique ID
                name: formData.get('item-name'),
                category: formData.get('item-category'),
                status: formData.get('item-status'),
                date: formData.get('item-date'),
                location: formData.get('item-location'),
                building: formData.get('item-building'),
                floor: formData.get('item-floor'),
                description: formData.get('item-description'),
                color: formData.get('item-color'),
                brand: formData.get('item-brand'),
                value: formData.get('item-value'),
                contact: formData.get('item-contact'),
                phone: formData.get('item-phone'),
                studentId: formData.get('item-student-id'),
                notes: formData.get('item-notes'),
                priority: formData.get('item-priority'),
                icon: getCategoryIcon(formData.get('item-category'))
            };
            
            // Add to sample items (in a real app, this would go to a database)
            if (typeof sampleItems !== 'undefined') {
                sampleItems.unshift(newItem);
            }
            
            // Show success message
            showSuccessMessage('Item created successfully!');
            
            // Reset form
            resetForm();
        }

        // Reset form
        function resetForm() {
            document.getElementById('create-item-form').reset();
            document.getElementById('item-date').value = new Date().toISOString().split('T')[0];
            updatePreview();
        }

        // Show success message
        function showSuccessMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message';
            messageDiv.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            `;
            
            const container = document.querySelector('.create-item-container');
            container.insertBefore(messageDiv, container.firstChild);
            
            // Remove message after 5 seconds
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // Get category icon
        function getCategoryIcon(category) {
            const iconMap = {
                'electronics': 'fas fa-laptop',
                'jewelry': 'fas fa-gem',
                'clothing': 'fas fa-tshirt',
                'documents': 'fas fa-file-alt',
                'keys': 'fas fa-key',
                'books': 'fas fa-book',
                'bags': 'fas fa-briefcase',
                'watches': 'fas fa-clock',
                'other': 'fas fa-question-circle'
            };
            
            return iconMap[category] || 'fas fa-question-circle';
        }

        // Initialize dynamic form features
        function initializeDynamicFeatures() {
            // Add progress indicator
            addProgressIndicator();
            
            // Add form validation feedback
            addFormValidation();
            
            // Add auto-save functionality
            addAutoSave();
        }

        // Add progress indicator
        function addProgressIndicator() {
            const form = document.getElementById('create-item-form');
            const progressBar = document.createElement('div');
            progressBar.className = 'form-progress';
            progressBar.innerHTML = `
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <div class="progress-text">Form Completion: <span class="progress-percentage">0%</span></div>
            `;
            
            form.insertBefore(progressBar, form.firstChild);
            
            // Update progress on form changes
            form.addEventListener('input', updateProgress);
            form.addEventListener('change', updateProgress);
        }

        // Update form progress
        function updateProgress() {
            const form = document.getElementById('create-item-form');
            const requiredFields = form.querySelectorAll('[required]');
            const filledFields = Array.from(requiredFields).filter(field => field.value.trim() !== '');
            const progress = Math.round((filledFields.length / requiredFields.length) * 100);
            
            const progressFill = document.querySelector('.progress-fill');
            const progressPercentage = document.querySelector('.progress-percentage');
            
            if (progressFill && progressPercentage) {
                progressFill.style.width = progress + '%';
                progressPercentage.textContent = progress + '%';
                
                // Change color based on progress
                if (progress < 50) {
                    progressFill.style.background = '#ef4444';
                } else if (progress < 100) {
                    progressFill.style.background = '#f59e0b';
                } else {
                    progressFill.style.background = '#10b981';
                }
            }
        }

        // Add form validation feedback
        function addFormValidation() {
            const form = document.getElementById('create-item-form');
            const inputs = form.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                input.addEventListener('blur', validateField);
                input.addEventListener('input', clearValidation);
            });
        }

        // Validate individual field
        function validateField(e) {
            const field = e.target;
            const value = field.value.trim();
            const isRequired = field.hasAttribute('required');
            
            if (isRequired && value === '') {
                showFieldError(field, 'This field is required');
            } else if (field.type === 'email' && value && !isValidEmail(value)) {
                showFieldError(field, 'Please enter a valid email address');
            } else {
                clearFieldError(field);
            }
        }

        // Show field error
        function showFieldError(field, message) {
            clearFieldError(field);
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'field-error';
            errorDiv.textContent = message;
            
            field.parentNode.appendChild(errorDiv);
            field.classList.add('error');
        }

        // Clear field error
        function clearFieldError(field) {
            const errorDiv = field.parentNode.querySelector('.field-error');
            if (errorDiv) {
                errorDiv.remove();
            }
            field.classList.remove('error');
        }

        // Clear validation on input
        function clearValidation(e) {
            clearFieldError(e.target);
        }

        // Validate email format
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Add auto-save functionality
        function addAutoSave() {
            const form = document.getElementById('create-item-form');
            const inputs = form.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                input.addEventListener('input', debounce(saveFormData, 1000));
            });
        }

        // Save form data to localStorage
        function saveFormData() {
            const form = document.getElementById('create-item-form');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            localStorage.setItem('createItemFormData', JSON.stringify(data));
        }

        // Load saved form data
        function loadSavedFormData() {
            const savedData = localStorage.getItem('createItemFormData');
            if (savedData) {
                const data = JSON.parse(savedData);
                const form = document.getElementById('create-item-form');
                
                Object.keys(data).forEach(key => {
                    const field = form.querySelector(`[name="${key}"]`);
                    if (field) {
                        field.value = data[key];
                    }
                });
                
                updatePreview();
                updateProgress();
            }
        }

        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Add form section animations
        function addFormSectionAnimations() {
            const sections = document.querySelectorAll('.form-section');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-in');
                    }
                });
            }, { threshold: 0.1 });
            
            sections.forEach(section => {
                observer.observe(section);
            });
        }

        // Load saved data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(loadSavedFormData, 100);
        });
    </script>
</body>
</html>
